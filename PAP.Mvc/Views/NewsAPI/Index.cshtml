@model List<NewsAPI.Models.Article>
@using System.Text.Json

<div class="container-fluid">

    <div class="bg-dark text-white sidebar p-3" style="width: 250px; height: 100vh; position: fixed; top: 0; left: 0; z-index: 100;">
        <h4 class="text-center">Menu</h4>
        <ul class="nav flex-column">
            <li class="nav-item">
                <a class="nav-link text-white" asp-area="" asp-controller="Home" asp-action="Index">
                    <i class="fas fa-home"></i> Home
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link text-white" asp-area="" asp-controller="Dashboard" asp-action="Index">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link text-white" asp-area="" asp-controller="Product" asp-action="Index">
                    <i class="fas fa-newspaper"></i> Product
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link text-white" asp-area="" asp-controller="Weather" asp-action="Index">
                    <i class="fas fa-cloud-sun"></i> Weather
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link text-white" asp-area="" asp-controller="About" asp-action="Index">
                    <i class="fas fa-info-circle"></i> ExampleAPI
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link text-white" asp-area="" asp-controller="Contact" asp-action="Index">
                    <i class="fas fa-envelope"></i> ExampleAPI
                </a>
            </li>
        </ul>
    </div>
    

    <div class="container-fluid" style="margin-left: 250px; padding-top: 20px;">
     
        <div class="container mt-4">
            <h2 class="text-center mb-4">Últimas Noticias</h2>

            <div class="list-group w-100">
                @foreach (var article in Model)
                {
                    <a href="@article.Url" class="list-group-item list-group-item-action d-flex gap-3 py-3" target="_blank">
                        @if (!string.IsNullOrEmpty(article.UrlToImage))
                        {
                            <img src="@article.UrlToImage" alt="Imagen" class="flex-shrink-0 me-3 rounded" style="width: 100px; height: 80px; object-fit: cover;">
                        }
                        <div class="d-flex flex-column">
                            <h6 class="mb-1">@article.Title</h6>
                            <p class="mb-0 text-muted">@article.Description</p>
                        </div>
                    </a>
                }
            </div>
        </div>

      
        <div class="container mt-5">
            <h2 class="text-center">Estadísticas de Noticias</h2>
            <canvas id="newsChart"></canvas>
        </div>
    </div>
</div>


@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Agrupamos las noticias por fuente y contamos cuántas hay de cada una
        const articles = @Html.Raw(JsonSerializer.Serialize(Model));

        const sourceCountMap = {};
        articles.forEach(article => {
            const sourceName = article.source?.name || "Desconocido";
            if (sourceCountMap[sourceName]) {
                sourceCountMap[sourceName]++;
            } else {
                sourceCountMap[sourceName] = 1;
            }
        });

        // Convertimos el objeto a arrays de nombres y cantidades (top 5)
        const sortedSources = Object.entries(sourceCountMap)
            .sort((a, b) => b[1] - a[1])
            .slice(0, 5);

        const sourceNames = sortedSources.map(entry => entry[0]);
        const sourceCounts = sortedSources.map(entry => entry[1]);

        const ctx = document.getElementById('newsChart').getContext('2d');
        const newsChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: sourceNames,
                datasets: [{
                    label: 'Cantidad de noticias por fuente',
                    data: sourceCounts,
                    backgroundColor: 'rgba(255, 99, 132, 0.6)',
                    borderColor: 'rgba(255, 99, 132, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Cantidad de noticias'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Fuente de noticia'
                        }
                    }
                }
            }
        });
    </script>
}




<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
<script src="~/js/site.js" asp-append-version="true"></script>
